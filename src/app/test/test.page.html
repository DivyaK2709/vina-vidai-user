<ion-header class="quiz-header">
  <ion-toolbar>
    <ion-title>Science Test</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Timer + Progress Bar -->
  <div class="top-bar" *ngIf="!showResult && !reviewMode">
    <div class="timer">⏳ {{ formatTime(timer) }}</div>
    <ion-progress-bar
      [value]="(currentQuestionIndex + 1) / questions.length"
      color="primary"
    ></ion-progress-bar>
    <div class="progress-text">
  Question {{ currentQuestionIndex + 1 }} / {{ questions.length }}
</div>

  </div>

  <!-- Quiz Section -->
  <div
    class="question-container"
    *ngIf="questions.length > 0 && !showResult && !reviewMode"
  >
    <h2>{{ questions[currentQuestionIndex]?.question }}</h2>

    <ion-list>
      <ion-item
        button
        *ngFor="let option of questions[currentQuestionIndex]?.options"
        (click)="selectOption(option)"
        [class.selected]="option === selectedOption"
      >
        <ion-label>{{ option }}</ion-label>
      </ion-item>
    </ion-list>
  </div>

  <!-- Buttons Row -->
  <div
    class="button-row"
    *ngIf="questions.length > 0 && !showResult && !reviewMode"
  >
    <ion-button
      class="prev-btn styled-btn"
      (click)="prevQuestion()"
      [disabled]="currentQuestionIndex === 0"
    >
      <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
      Previous
    </ion-button>

    <ion-button
      *ngIf="currentQuestionIndex < questions.length - 1"
      class="next-btn styled-btn"
      (click)="nextQuestion()"
      [disabled]="!answered"
    >
      Next
      <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
    </ion-button>

    <ion-button
      *ngIf="currentQuestionIndex === questions.length - 1"
      class="submit-btn styled-btn"
      (click)="submitQuiz()"
      [disabled]="!answered"
    >
      Submit
    </ion-button>
  </div>

  <!-- ✅ Result Popup -->
  <div *ngIf="showResult" class="result-popup">
    <div class="popup-card" [ngClass]="resultColor">
      <p class="message">
        You got {{ correctCount }} / {{ questions.length }} correct.<br />
        Time taken: {{ formatTime(duration - timer) }}

      </p>
      <ion-button expand="block" [color]="resultColor" (click)="goToReview()">
        OK
      </ion-button>
    </div>
  </div>

  <!-- ✅ Review Mode -->
  <div *ngIf="reviewMode" class="review-container">
    <h2>Review Answers</h2>
    <div *ngFor="let q of questions; let i = index" class="review-question">
      <p class="question">{{ i + 1 }}. {{ q.question }}</p>
      <div *ngFor="let option of q.options">
        <p
          class="option"
          [ngClass]="{
            'correct': option === q.answer,
            'wrong': option === userAnswers[q.id] && option !== q.answer
          }"
        >
          {{ option }}
        </p>
      </div>
    </div>
  </div>
</ion-content>
